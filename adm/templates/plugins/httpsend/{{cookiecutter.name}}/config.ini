{% extends "_common/config.ini" %}

{% set cmd="send.py" %}
{% set main_step="step_send" %}

{% block specific_args %}
# Arguments below are asked for value when running
#   bootstrap_plugin2.py create --template httpsend [--make [--install] [--delete] ] name
# http-method : PUT, POST, GET, OPTIONS, HEAD, PATCH or DELETE (default : POST)
arg_http-method = {{cookiecutter.http_method}}
# http-url : http url to invoke with the file as body
# you can use some placeholders in this url:
# - {ORIGINAL_BASENAME}
# - {ORIGINAL_DIRNAME}
# - {RANDOM_ID}
# - {STEP_COUNTER}
# - {ORIGINAL_UID}
# - strftime placeholders like %Y%m%d...
#Example : http://FIXME:9091/incoming/{ORIGINAL_BASENAME}
arg_http-url = {{cookiecutter.http_url}}
# http-timeout : http timeout (in seconds, default 60)
arg_http-timeout = {{cookiecutter.http_timeout}}
# http-ok-status-codes : comma separated list of "ok" status codes
#   Default is : 200,201
arg_http-ok-status-codes = {{cookiecutter.http_ok_status_codes}}
{% endblock %}

{% block failure_policy %}
# Failure policy : keep (default), delete or move
arg_failure-policy = move
# Destination directory when failure-policy is move (mandatory in this case)
arg_failure-policy-move-dest-dir = {% raw %}{{MFDATA_DATA_IN_DIR}}{% endraw %}/step.{% raw %}{{MFDATA_CURRENT_PLUGIN_NAME}}{% endraw %}.reinject
# Keep tags in an additional file when failure-policy is move (default yes = 1)
arg_failure-policy-move-keep-tags = 0
# Suffix to add to the filename to keep tags when failure-policy-move-keep-tags
#    is True (default ".tags")
#arg_failure-policy-move-keep-tags-suffix = .tags
{% endblock %}

{% block switch %}
switch_logical_condition = {{cookiecutter.switch_logical_condition}}
switch_use_hardlink = True
{% endblock %}

{% block extra_steps %}
[step_reinject]
cmd_and_args = {% raw %}{{MFDATA_CURRENT_PLUGIN_DIR}}{% endraw %}/reinject.py --config-file={% raw %}{{MFDATA_CURRENT_CONFIG_INI_PATH}}{% endraw %} --redis-unix-socket-path={% raw %}{{MFMODULE_RUNTIME_HOME}}{% endraw %}/var/redis.socket {% raw %}{{MFDATA_CURRENT_STEP_QUEUE}}{% endraw %}
arg_reinject-dir = {% raw %}{{MFDATA_DATA_IN_DIR}}{% endraw %}/step.{% raw %}{{MFDATA_CURRENT_PLUGIN_NAME}}{% endraw %}.send
arg_reinject-delay = {{cookiecutter.reinject_delay}}
arg_reinject-attempts = {{cookiecutter.reinject_attempts}}
switch_logical_condition = False
numprocesses = 1
graceful_timeout = 600
max_age = 310
rlimit_as = 1000000000
rlimit_nofile = 1000
rlimit_nproc = 100
rlimit_stack = 10000000
rlimit_fsize = 10000000000
{% endblock %}
